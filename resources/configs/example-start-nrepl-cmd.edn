;; Example configuration demonstrating :start-nrepl-cmd usage
;; This feature allows the MCP server to automatically start an nREPL server
;; and discover the port number from command output or .nrepl-port file.

{:allowed-directories ["." "src" "test" "resources"]
 
 ;; Automatically start nREPL server (requires additional config for port discovery)
 :start-nrepl-cmd "lein repl :start :port 0"
 ;; :parse-nrepl-port true  ; Explicitly enable to parse port from command output
 
 ;; Alternative: Parse port from command output
 ;; :start-nrepl-cmd "lein repl :start :port 0"
 ;; :parse-nrepl-port true
 
 ;; Both options together (recommended for reliability):
 ;; Coordinates execution to ensure fresh .nrepl-port file
 ;; :start-nrepl-cmd "lein repl :start :port 0" 
 ;; :read-nrepl-port-file true
 
 ;; Read existing .nrepl-port file without starting command:
 ;; :read-nrepl-port-file true
 
 ;; Other common examples:
 ;; For deps.edn projects with an nREPL alias:
 ;; :start-nrepl-cmd "clojure -M:nrepl"
 ;; 
 ;; For Shadow-cljs projects:
 ;; :start-nrepl-cmd "npx shadow-cljs watch app"
 ;;
 ;; For Boot projects:
 ;; :start-nrepl-cmd "boot repl"
 ;;
 ;; Custom command with specific port range:
 ;; :start-nrepl-cmd "clojure -M -e '(require \"[nrepl.server :as s]\") (s/start-server :port 0)'"

 ;; Standard configuration options
 :write-file-guard :partial-read
 :cljfmt true
 :bash-over-nrepl true}

;; Notes on port discovery options:
;; 
;; 1. :parse-nrepl-port (must be explicitly enabled)
;;    - Parses command output for port numbers using patterns like:
;;      * "nREPL server started on port 7888"
;;      * "Started nREPL on port: 7888" 
;;      * "Port: 7888"
;;      * Standalone 4-5 digit numbers
;;    - Only valid when :start-nrepl-cmd is also configured
;;    - Set to true to enable stdout parsing
;;
;; 2. :read-nrepl-port-file
;;    - Reads port number from .nrepl-port file in working directory
;;    - Can be used independently or with :start-nrepl-cmd
;;    - When used with :start-nrepl-cmd, coordinates execution for file freshness
;;
;; 3. Port Discovery Priority:
;;    - Explicit :port argument (highest priority)
;;    - :start-nrepl-cmd + :read-nrepl-port-file (coordinated)
;;    - :start-nrepl-cmd + :parse-nrepl-port 
;;    - :read-nrepl-port-file alone
;;    - :start-nrepl-cmd without parsing (backward compatibility)
;;
;; 4. Timeout: Commands have a 30-second timeout by default
;;
;; 5. Error Handling: If the command fails, times out, or no port is found,
;;    the MCP server will terminate with an error message
;;
;; 6. Working Directory: Commands execute in the project directory
;;
;; 7. Process Management: Started processes are tracked and cleaned up
;;    when the MCP server shuts down
;;
;; 8. File Freshness: When both :start-nrepl-cmd and :read-nrepl-port-file
;;    are enabled, existing .nrepl-port files are deleted before starting
;;    the command to ensure only fresh files are read